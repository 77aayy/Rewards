# مهمة: مصدر واحد لنافذة «شروط الحصول على المكافآت»

## الهدف
زر «شروط المكافآت» يفتح نافذة واحدة من حيث **المحتوى** و**التصميم** و**السلوك** في كل الأماكن اللي الزر يظهر فيها، بدل ما يختلف من مكان للتاني.

## أين الزر بيظهر (يجب أن يبقى يعمل في كلهم)
- صفحة **التحليل** (React – App.tsx، مكوّن ConditionsPopup)
- صفحة **المكافآت** (rewards – index.html + app.js، نافذة conditionsModal)
- **صفحات الإداريين** (أي شاشة أدمن فيها نفس الزر)

## القيود والمتعلقات (مهم عند التنفيذ)
- المحتوى **ديناميكي**: أسعار من config (مثلاً rateMorning، rateEvening، VIP، تقييمات، إلخ).
- النافذة **مرتبطة بالخصومات**: فيه نصوص وقواعد عن خصومات التقصير وربط بالتعليمات.
- الزر **متكرر** في أكثر من واجهة؛ أي تغيير يلزم لا يكسر أي استخدام (تحليل، مكافآت، أدمن).

## المطلوب تحقيقه
1. **مصدر واحد للمحتوى**: تعريف الشروط (العناوين، الفقرات، القوائم) في مكان واحد (مثلاً ملف مشترك أو بيانات مشتركة)؛ الطرفان (React و rewards) يقرآن من نفس المصدر ويعرضان نفس النص مع حقن القيم الديناميكية (أسعار، VIP، إلخ).
2. **مصدر واحد للشكل**: نفس شكل النافذة (خلفية، حدود، أزرار إغلاق/طباعة، تنسيق المحتوى) في التحليل والمكافآت وصفحات الإداريين.
3. **سلوك موحّد**: نفس طريقة الفتح/الإغلاق والطباعة (إن وُجدت) في كل الأماكن، مع الحفاظ على أي ربط بالتعليمات أو الخصومات.

## ملاحظات للخطة التنفيذية
- تحديد **مصدر المحتوى** (ملف HTML، JSON، أو موديول) والاتفاق على مكانه (مثلاً `shared/`).
- تحديد كيف يتم **حقن القيم الديناميكية** (أسعار، VIP، خصومات) في الطرفين بدون تكرار المنطق.
- التأكد أن **صفحات الإداريين** تستخدم نفس المصدر ولا يُحذف أو يُستبدل أي سلوك مرتبط بالخصومات أو التعليمات.
- بعد التنفيذ: اختبار الزر في (التحليل، المكافآت، أي صفحة أدمن فيها الزر) والتأكد أن المحتوى والشكل والسلوك واحد.

---

## رأي وتعديلات مقترحة على الخطة التنفيذية

الخطة **مناسبة** وواضحة. التعديلات التالية اختيارية لتدعيم التنفيذ فقط:

1. **نسخ الـ JSON لـ Rewards:** توضيح صريح في الخطوات: تعديل `app/Rewards/scripts/prepare-deploy.js` لنسخ `app/shared/conditions-content.json` إلى `Rewards/public/shared/` (مع `headerButtonsConfig.json`) حتى يكون المسار `/rewards/shared/conditions-content.json` متاحاً بعد `npm run sync:rewards`.
2. **زر الطباعة في React:** أن يكون محتوى الطباعة ناتجاً من **نفس المنطق** (JSON + pricing) وليس نسخة يدوية، حتى لا يحدث انحراف بين المطبوع من التحليل والمطبوع من المكافآت.
3. **التحقق من الأدوار:** عند الاختبار النهائي، التأكد أن **إظهار/إخفاء** الزر حسب الدور (rewards-rbac) لم يتأثر، وفتح النافذة يعمل لأدمن ومشرف وHR ومحاسبة ومدير.
4. **بعد أي تعديل في Rewards:** تشغيل `npm run sync:rewards` من مجلد `app` وتجربة صفحة المكافآت من الواجهة المُخدمة (لا الاعتماد على `Rewards/` فقط).
